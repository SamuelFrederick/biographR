<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="biographR">
<title>Improving model output • biographR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Improving model output">
<meta property="og:description" content="biographR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">biographR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Cleaning-Columns.html">Cleaning Columns</a>
    <a class="dropdown-item" href="../articles/Improving-model-output.html">Improving model output</a>
    <a class="dropdown-item" href="../articles/get_bio.html">get_bio</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Improving model output</h1>
            
      
      
      <div class="d-none name"><code>Improving-model-output.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://samuelfrederick.github.io/biographR/">biographR</a></span><span class="op">)</span></span></code></pre></div>
<p>ChatGPT is <strong>not perfect</strong> at extracting information and
can often make mistakes, but there are several routes to improve the
output and to check the output.</p>
<ol style="list-style-type: decimal">
<li><a href="#hand-coding-data">Hand-Coding Data</a></li>
<li><a href="#changing-model-version">Changing Model Version</a></li>
<li><a href="#few-shot">Few-Shot Prompting</a></li>
<li><a href="#custom-prompts">Custom Prompts</a></li>
<li><a href="#post-processing-output">Post-Processing Output</a></li>
<li><a href="#combination-of-approaches">Combination of
Approaches</a></li>
</ol>
<div class="section level2">
<h2 id="hand-coding-data">Hand-Coding Data<a class="anchor" aria-label="anchor" href="#hand-coding-data"></a>
</h2>
<p>It is generally good practice to hand-code a random sample of your
data. This can help in several ways. First, it gives you an idea of what
type of information you can extract from your data. With this
information in hand, you can decide what to input to functions like
<code><a href="../reference/get_bio.html">get_bio()</a></code>. Second, hand-coding will give you a dataset with
which you can evaluate the performance of output from ChatGPT. Third,
you can use these data as inputs for <a href="#few-shot">few-shot
prompting</a> which can help improve output from ChatGPT.</p>
</div>
<div class="section level2">
<h2 id="changing-model-version">Changing Model Version<a class="anchor" aria-label="anchor" href="#changing-model-version"></a>
</h2>
<p><code>biographR</code> defaults to <code>gpt-3.5-turbo</code> because
it is less expensive than <code>gpt-4</code> and generally performs
quite well. However, other models like <code>gpt-4</code> and
<code>gpt-4-1106-preview</code> can give better performance. In
particular, GPT-4 models perform better on function calling, according
to <a href="https://openai.com/blog/function-calling-and-other-api-updates" class="external-link">OpenAI</a>
and, anecdotally, appear to do a better job extracting subtler
information like gender from pronouns. You can change which model you’re
using in <code>biographR</code> through the <code>openai_model</code>
argument.</p>
</div>
<div class="section level2">
<h2 id="few-shot">Few-Shot Prompting<a class="anchor" aria-label="anchor" href="#few-shot"></a>
</h2>
<p>ChatGPT output can also be improved by providing ChatGPT with
exemplars of the task you want it to complete – what is known as <a href="https://proceedings.neurips.cc/paper_files/paper/2020/file/1457c0d6bfcb4967418bfb8ac142f64a-Paper.pdf" class="external-link">“few-shot”
prompting</a>. This is another way that hand-coded biographical texts
can come in handy: they give you some examples with which to improve
ChatGPT responses.</p>
<p>Few-shot prompting is supported in <code>biographR</code> using the
<code>prompt_fewshot</code> argument in <code><a href="../reference/get_bio.html">get_bio()</a></code> and
<code><a href="../reference/get_bio.html">get_bio_function_call()</a></code>. The <code>prompt_fewshot</code>
argument accepts a data.frame or tibble containing the example bio, the
example bio_name (if applicable), and the results for every field in
your prompt_fields argument.</p>
<p>For example, we might have three exemplars of the type of information
we want. We would pass this information to the
<code>prompt_fewshot</code> argument in this form:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prompt_fewshot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  bio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"John Smith went to Nowhere University where he earned his B.A."</span>, </span>
<span>          <span class="st">"Sally Smith went to Hogwarts where she studied magic and earned her BS in potions."</span>, </span>
<span>          <span class="st">"Adam Driver got his BFA from Juilliard."</span><span class="op">)</span>, </span>
<span>  bio_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"John Smith"</span>, <span class="st">"Sally Smith"</span>, <span class="st">"Adam Driver"</span><span class="op">)</span>, </span>
<span>  gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span>, </span>
<span>  undergraduate_education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nowhere University - Bachelor's"</span>, </span>
<span>              <span class="st">"Hogwarts - Bachelor's"</span>,</span>
<span>              <span class="st">"Juilliard - Bachelor's"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then pass this information to one of our functions like this
(from <a href="https://en.wikipedia.org/wiki/Joe_Biden" class="external-link">Joe Biden’s
Wikipedia page</a>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_bio.html">get_bio</a></span><span class="op">(</span>bio <span class="op">=</span> <span class="st">"Joseph Robinette Biden Jr. is an American politician who is the 46th and current president of the United States. A member of the Democratic Party, he previously served as the 47th vice president from 2009 to 2017 under President Barack Obama and represented Delaware in the United States Senate from 1973 to 2009. Born in Scranton, Pennsylvania, Biden moved with his family to Delaware in 1953. He graduated from the University of Delaware before earning his law degree from Syracuse University."</span>, </span>
<span>        bio_name <span class="op">=</span> <span class="st">"Joe Biden"</span>, </span>
<span>        prompt_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"undergraduate_education"</span>, <span class="st">"gender"</span><span class="op">)</span>, </span>
<span>        prompt_fields_formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>undergraduate_education <span class="op">=</span> <span class="st">"{UNDERGRADUATE SCHOOL} - {DEGREE}"</span><span class="op">)</span>, </span>
<span>        prompt_fewshot <span class="op">=</span> <span class="va">prompt_fewshot</span><span class="op">)</span></span>
<span><span class="co">#&gt; Input Tokens: 595</span></span>
<span><span class="co">#&gt; Output Tokens: 23</span></span>
<span><span class="co">#&gt; Total Tokens: 618</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   undergraduate_education                                               gender</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> University of Delaware - Bachelor's; Syracuse University - Law degree Male</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-prompts">Custom Prompts<a class="anchor" aria-label="anchor" href="#custom-prompts"></a>
</h2>
<p>It can be hard to design a perfect prompt, and different tasks might
require different approaches. The <code><a href="../reference/get_bio.html">get_bio()</a></code> function
supports adding unique prompts which override the default through the
<code>prompt</code> argument. When a custom prompt is supplied, the
output of the function will be unprocessed (i.e., <code><a href="../reference/get_bio.html">get_bio()</a></code>
won’t output a tibble), so that you can specify whichever form of output
you prefer.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_bio.html">get_bio</a></span><span class="op">(</span>bio <span class="op">=</span> <span class="st">"Joseph Robinette Biden Jr. is an American politician who is the 46th and current president of the United States. A member of the Democratic Party, he previously served as the 47th vice president from 2009 to 2017 under President Barack Obama and represented Delaware in the United States Senate from 1973 to 2009. Born in Scranton, Pennsylvania, Biden moved with his family to Delaware in 1953. He graduated from the University of Delaware before earning his law degree from Syracuse University."</span>, </span>
<span>        bio_name <span class="op">=</span> <span class="st">"Joe Biden"</span>, </span>
<span>        prompt <span class="op">=</span> <span class="st">"Return ONLY a CSV format containing the gender and highest level of education for Joe Biden with columns 'gender' and 'highest_level_of_education'"</span></span>
<span>        <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Custom prompt provided, bio_name argument will be ignored.</span></span>
<span><span class="co">#&gt; Input Tokens: 166</span></span>
<span><span class="co">#&gt; Output Tokens: 12</span></span>
<span><span class="co">#&gt; Total Tokens: 178</span></span>
<span><span class="co">#&gt; [1] "gender,highest_level_of_education\nMale,Law degree"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="post-processing-output">Post-Processing Output<a class="anchor" aria-label="anchor" href="#post-processing-output"></a>
</h2>
<p>A fifth approach we can take to improve our output involves
post-processing our results. For example, if we gather data from a bunch
of biographies, we may end up with data that are not in a common format
(e.g., calling a Bachelor’s degree a B.A., B.S., B.F.A., Bachelor’s,
etc.). You can, of course, post-process these data using regex or even
by hand, but we can also use ChatGPT to post-process these data. The
<code><a href="../reference/clean_columns.html">clean_columns()</a></code> function implements post-processing of
data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>highest_level_of_education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B.A."</span>, <span class="st">"BA"</span>, <span class="st">"BFA"</span>, <span class="st">"Ph.D."</span>, <span class="st">"Master's"</span><span class="op">)</span>, </span>
<span>                           state_of_birth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CA"</span>, <span class="st">"Calif."</span>, <span class="st">"California"</span>, <span class="st">"NY"</span>, <span class="st">"New York"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clean_columns.html">clean_columns</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">example_data</span>, </span>
<span>              column_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>highest_level_of_education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span>, </span>
<span>                                   state_of_birth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CA"</span>, <span class="st">"NY"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; highest_level_of_education</span></span>
<span><span class="co">#&gt; Input Tokens: 119</span></span>
<span><span class="co">#&gt; Output Tokens:113</span></span>
<span><span class="co">#&gt; Total Tokens:232</span></span>
<span><span class="co">#&gt; state_of_birth</span></span>
<span><span class="co">#&gt; Input Tokens: 106</span></span>
<span><span class="co">#&gt; Output Tokens:25</span></span>
<span><span class="co">#&gt; Total Tokens:131</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   highest_level_of_education state_of_birth highest_level_of_education_gpt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> B.A.                       CA             College                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> BA                         Calif.         College                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> BFA                        California     College                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ph.D.                      NY             Graduate School               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Master's                   New York       Graduate School               </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: state_of_birth_gpt &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combination-of-approaches">Combination of Approaches<a class="anchor" aria-label="anchor" href="#combination-of-approaches"></a>
</h2>
<p>Finally, we can combine these approaches to produce better output: we
can use more advanced GPT models with few-shot-prompting, custom
prompts, and post-processing of data. And users should always check the
output of these models: hand-coding data can allow you to assess the
accuracy of ChatGPT output.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Samuel Frederick.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
