<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="biographR">
<title>Cleaning Columns • biographR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cleaning Columns">
<meta property="og:description" content="biographR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">biographR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Cleaning-Columns.html">Cleaning Columns</a>
    <a class="dropdown-item" href="../articles/Improving-model-output.html">Improving model output</a>
    <a class="dropdown-item" href="../articles/get_bio.html">get_bio</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Cleaning Columns</h1>
            
      
      
      <div class="d-none name"><code>Cleaning-Columns.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://samuelfrederick.github.io/biographR/">biographR</a></span><span class="op">)</span></span></code></pre></div>
<p>The data that we work with are often in unusable formats. For
example, we might have data about individuals’ education, but the
education could contain values like “BA”, “AB”, “B.A.”, “Bachelor’s”,
“College”, etc. Similarly, we often want to merge datasets but don’t
have unique identifiers in common form. We might have names in one
dataset with the form “LASTNAME, FirstName MiddleName, Suffix” and in
another dataset with the form “FirstName LASTNAME”.</p>
<p>We could use regex to process the data into our desired output;
however, regex can sometimes miss or misclassify entries. Moreover, it
can be challenging to write regex to capture all cases. Note: I would
generally recommend trying to process your columns first using regex
before trying ChatGPT. Additionally, pre-processing your columns using
regex before using ChatGPT can help cut down on the number of tokens you
are sending in the API calls (and therefore, cut down on costs).</p>
<p>The <code>biographR</code> package has two functions to help clean
and reformat columns using ChatGPT: <code><a href="../reference/clean_columns.html">clean_columns()</a></code> and
<code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code>. As an example, we’ll make a
fake dataset containing some birthdates and educational values:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BA"</span>, <span class="st">"B.A."</span>, <span class="st">"GED"</span>, <span class="st">"Ph.D."</span>, </span>
<span>                               <span class="st">"MD"</span>, <span class="st">"Master's"</span>, <span class="st">"High School Diploma"</span><span class="op">)</span>, </span>
<span>                 birthdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sept. 19th, 1974"</span>, <span class="st">"October 20, 1963"</span>, <span class="st">"3.12.1987"</span>, </span>
<span>                               <span class="st">"15 of April in 1990"</span>, <span class="st">"7/6/81"</span>, <span class="st">"3rd of August, 1953"</span>, </span>
<span>                               <span class="st">"2/14/1934"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="using-clean_columns">Using <code>clean_columns()</code><a class="anchor" aria-label="anchor" href="#using-clean_columns"></a>
</h2>
<p>We can start cleaning our data using the <code><a href="../reference/clean_columns.html">clean_columns()</a></code>
function. In addition to the usual API specifications (API key, model,
temperature, and seed), <code><a href="../reference/clean_columns.html">clean_columns()</a></code> takes three main
arguments: <code>data</code>, <code>column_values</code>, and
<code>column_formats</code>. The <code>data</code> argument contains the
dataset we want to clean.</p>
<p><code>column_values</code> and <code>column_formats</code> should be
lists, named with the names of the columns you want to process and
containing the desired output values and formats. For example, for our
education column above we might use the <code>column_values</code>
argument to pass the list
<code>list(education = c("High School or less", "College", "Graduate School"))</code>.
<code><a href="../reference/clean_columns.html">clean_columns()</a></code> will then use ChatGPT to attempt to match
your educational data to these values.</p>
<p>For <code>column_formats</code>, for our birthdate column, we might
pass <code>list(birthdate = "MM/DD/YYYY")</code> to the
<code>column_formats</code> argument.</p>
<p>The <code><a href="../reference/clean_columns.html">clean_columns()</a></code> function makes separate API calls
for each column to be cleaned, and it outputs the original dataset with
the cleaned columns denoted by a “_gpt” suffix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_columns.html">clean_columns</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>              column_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              column_formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>birthdate <span class="op">=</span> <span class="st">"MM/DD/YYYY"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; education</span></span>
<span><span class="co">#&gt; Input Tokens: 116</span></span>
<span><span class="co">#&gt; Output Tokens:154</span></span>
<span><span class="co">#&gt; Total Tokens:270</span></span>
<span><span class="co">#&gt; birthdate</span></span>
<span><span class="co">#&gt; Input Tokens: 144</span></span>
<span><span class="co">#&gt; Output Tokens:74</span></span>
<span><span class="co">#&gt; Total Tokens:218</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">#&gt;   education           birthdate           education_gpt       birthdate_gpt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> BA                  Sept. 19th, 1974    College             09/19/1974   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B.A.                October 20, 1963    College             10/20/1963   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GED                 3.12.1987           High School or less 03/12/1987   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ph.D.               15 of April in 1990 Graduate School     04/15/1990   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MD                  7/6/81              Graduate School     07/06/1981   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Master's            3rd of August, 1953 Graduate School     08/03/1953   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> High School Diploma 2/14/1934           High School or less 02/14/1934</span></span></code></pre></div>
<div class="section level3">
<h3 id="few-shot-prompting-with-clean_columns">Few-Shot Prompting with <code>clean_columns()</code><a class="anchor" aria-label="anchor" href="#few-shot-prompting-with-clean_columns"></a>
</h3>
<p>There are three key arguments for few-shot prompting with
<code><a href="../reference/clean_columns.html">clean_columns()</a></code>: <code>prompt_fewshot_type</code>,
<code>prompt_fewshot_n</code>, and <code>prompt_fewshot</code>.</p>
<p>First, <code>prompt_fewshot_type</code> should be either “specific”
or “general”. The value “specific” indicates that the provided examples
are specific to the columns you want to clean. For example, if we
provide examples for education and birthdate,
<code><a href="../reference/clean_columns.html">clean_columns()</a></code> will <em>only</em> use the education
examples for few-shot prompting the education cleaning and will
<em>only</em> use the birthdate examples for few-shot prompting the
birthdate cleaning.</p>
<p>The value “general” indicates that the provided examples are not
specific to the columns you want to clean. All examples will be used for
few-shot prompting every column API call. For example, both education
and birthdate examples will be used in few-shot prompting education
cleaning.</p>
<p>I would generally recommend using
<code>prompt_fewshot_type="specific"</code> (and this is the default
value), unless you have a compelling reason not to do so.</p>
<p>Second, <code>prompt_fewshot_n</code> tells
<code><a href="../reference/clean_columns.html">clean_columns()</a></code> whether you want to split your few-shot
examples into multiple example prompts and outputs. For example, if you
provide 10 examples for education, setting
<code>prompt_fewshot_n=2</code> would split those 10 examples into two
separate example prompts and outputs for ChatGPT. You can give different
values for different columns by passing a named list to
<code>prompt_fewshot_n</code> (e.g.,
<code>list(education = 2, birthdate = 4)</code>).</p>
<p>Third, <code>prompt_fewshot</code> contains your examples for column
cleaning. For <code><a href="../reference/clean_columns.html">clean_columns()</a></code>, this can be a list, a
tibble, or a data.frame. It should contain example input and example
output (with the same name as input but with suffix “_gpt”). If
<code>prompt_fewshot_type</code> is “general”, you might also want to
input values and formats for the examples; these should be separate
columns or list entries with the suffixes “_values” and “_formats”,
respectively.</p>
<div class="section level4">
<h4 id="specific-few-shot-example">Specific Few-Shot Example<a class="anchor" aria-label="anchor" href="#specific-few-shot-example"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_columns.html">clean_columns</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>              column_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              prompt_fewshot_type <span class="op">=</span> <span class="st">"specific"</span>,</span>
<span>              prompt_fewshot_n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              prompt_fewshot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GED"</span>, <span class="st">"BA"</span>, <span class="st">"MPhil"</span>, <span class="st">"BS"</span>, <span class="st">"Bachelor's"</span>, <span class="st">"10th grade"</span><span class="op">)</span>,</span>
<span>                                          education_gpt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span>, <span class="st">"College"</span>, <span class="st">"College"</span>, <span class="st">"High School or less"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; education</span></span>
<span><span class="co">#&gt; Input Tokens: 205</span></span>
<span><span class="co">#&gt; Output Tokens:31</span></span>
<span><span class="co">#&gt; Total Tokens:236</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 3</span></span></span>
<span><span class="co">#&gt;   education           birthdate           education_gpt      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> BA                  Sept. 19th, 1974    College            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B.A.                October 20, 1963    College            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GED                 3.12.1987           High School or less</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ph.D.               15 of April in 1990 Graduate School    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MD                  7/6/81              Graduate School    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Master's            3rd of August, 1953 Graduate School    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> High School Diploma 2/14/1934           High School or less</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="general-few-shot-example">General Few-Shot Example<a class="anchor" aria-label="anchor" href="#general-few-shot-example"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_columns.html">clean_columns</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>              column_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              prompt_fewshot_type <span class="op">=</span> <span class="st">"general"</span>,</span>
<span>              prompt_fewshot_n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              prompt_fewshot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GED"</span>, <span class="st">"BA"</span>, <span class="st">"MPhil"</span><span class="op">)</span>,</span>
<span>                                    education_gpt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span>,</span>
<span>                                    education_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span>,</span>
<span>                                    birthdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"August 9, 1978"</span>, <span class="st">"Oct 10, 1935"</span>, <span class="st">"11th of January 1957"</span><span class="op">)</span>,</span>
<span>                                    birthdate_gpt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"08/09/1978"</span>, <span class="st">"10/10/1935"</span>, <span class="st">"01/11/1957"</span><span class="op">)</span>,</span>
<span>                                    birthdate_format <span class="op">=</span> <span class="st">"MM/DD/YYYY"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; education</span></span>
<span><span class="co">#&gt; Input Tokens: 277</span></span>
<span><span class="co">#&gt; Output Tokens:31</span></span>
<span><span class="co">#&gt; Total Tokens:308</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 3</span></span></span>
<span><span class="co">#&gt;   education           birthdate           education_gpt      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> BA                  Sept. 19th, 1974    College            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B.A.                October 20, 1963    College            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GED                 3.12.1987           High School or less</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ph.D.               15 of April in 1990 Graduate School    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MD                  7/6/81              Graduate School    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Master's            3rd of August, 1953 Graduate School    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> High School Diploma 2/14/1934           High School or less</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="using-clean_columns_function_call">Using <code>clean_columns_function_call()</code><a class="anchor" aria-label="anchor" href="#using-clean_columns_function_call"></a>
</h2>
<p>We can also use ChatGPT’s function calling feature which provides
ChatGPT with an overview of a “function.” ChatGPT then extracts the data
corresponding to the arguments of the function and returns these
arguments, so that the user can enter the arguments into the function.
This is implemented for column cleaning using the
<code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code> function.</p>
<p><code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code> is broadly similar to
<code><a href="../reference/clean_columns.html">clean_columns()</a></code> with four main differences:</p>
<ol style="list-style-type: decimal">
<li>It adds the optional <code>column_descriptions</code> argument
which, like <code>column_values</code> and <code>column_formats</code>,
is a named list of characters with names from the columns of
<code>data</code>. The values are the descriptions of the arguments of
the function call, if desired. For example, you may wish to describe
what exactly should be in the cleaned column apart from the values and
formats.</li>
<li>It does not take a <code>prompt_fewshot_type</code> argument.</li>
<li>
<code>prompt_fewshot_n</code> must be an integer.</li>
<li>It adds the optional <code>openai_context_window</code> argument.
Because <code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code> tries to clean all of
the columns in one API call, some column combinations might be larger
than what can be processed by ChatGPT. In this case,
<code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code> tries to break the columns up
into separate API calls which are smaller than the context window.</li>
</ol>
<p>Now, we can try using <code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code> with
our data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_columns.html">clean_columns_function_call</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>              column_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              column_formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>birthdate <span class="op">=</span> <span class="st">"MM/DD/YYYY"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; education, birthdate</span></span>
<span><span class="co">#&gt; Input Tokens: 269</span></span>
<span><span class="co">#&gt; Output Tokens: 99</span></span>
<span><span class="co">#&gt; Total Tokens: 368</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">#&gt;   education           birthdate           education_gpt       birthdate_gpt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> BA                  Sept. 19th, 1974    College             09/19/1974   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B.A.                October 20, 1963    College             10/20/1963   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GED                 3.12.1987           High School or less 12/03/1987   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ph.D.               15 of April in 1990 Graduate School     04/15/1990   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MD                  7/6/81              Graduate School     07/06/1981   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Master's            3rd of August, 1953 Graduate School     08/03/1953   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> High School Diploma 2/14/1934           High School or less 02/14/1934</span></span></code></pre></div>
<div class="section level3">
<h3 id="few-shot-prompting-with-clean_columns_function_call">Few-Shot Prompting with
<code>clean_columns_function_call()</code><a class="anchor" aria-label="anchor" href="#few-shot-prompting-with-clean_columns_function_call"></a>
</h3>
<p>Like <code><a href="../reference/clean_columns.html">clean_columns()</a></code>,
<code><a href="../reference/clean_columns.html">clean_columns_function_call()</a></code> also supports few-shot
prompting, which may improve output. For more details on the specifics
of few-shot prompting, see [Few-Shot Prompting with
`clean_columns_function_call()].</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_columns.html">clean_columns_function_call</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>              column_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              column_formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>birthdate <span class="op">=</span> <span class="st">"MM/DD/YYYY"</span><span class="op">)</span>, </span>
<span>              prompt_fewshot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GED"</span>, <span class="st">"BA"</span>, <span class="st">"MPhil"</span><span class="op">)</span>, </span>
<span>                                    education_gpt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High School or less"</span>, <span class="st">"College"</span>, <span class="st">"Graduate School"</span><span class="op">)</span>,</span>
<span>                                    birthdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"August 9, 1978"</span>, <span class="st">"Oct 10, 1935"</span>, <span class="st">"11th of January 1957"</span><span class="op">)</span>,</span>
<span>                                    birthdate_gpt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"08/09/1978"</span>, <span class="st">"10/10/1935"</span>, <span class="st">"01/11/1957"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; education, birthdate</span></span>
<span><span class="co">#&gt; Input Tokens: 408</span></span>
<span><span class="co">#&gt; Output Tokens: 80</span></span>
<span><span class="co">#&gt; Total Tokens: 488</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">#&gt;   education           birthdate           education_gpt       birthdate_gpt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> BA                  Sept. 19th, 1974    College             09/19/1974   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B.A.                October 20, 1963    College             10/20/1963   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GED                 3.12.1987           High School or less 12/03/1987   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ph.D.               15 of April in 1990 Graduate School     04/15/1990   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MD                  7/6/81              Graduate School     07/06/1981   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Master's            3rd of August, 1953 Graduate School     08/03/1953   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> High School Diploma 2/14/1934           High School or less 02/14/1934</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Samuel Frederick.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
